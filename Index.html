<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Sanctum</title>
<meta name="theme-color" content="#0b0b11" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<style>
  :root{--bg:#0b0b11;--ink:#e7e7ee;--dim:#b6b6c8;--line:#353549;--veil:rgba(8,7,20,.96);--nova:#a7a9ff}
  *{box-sizing:border-box} html,body{height:100%;margin:0;background:radial-gradient(1000px 700px at 70% 12%,#17182a 0%,var(--bg) 55%);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:880px;margin:0 auto;padding:42px 24px 100px}
  h1{font-weight:700;letter-spacing:.04em;margin:0 0 8px}
  .subtitle{color:var(--dim);margin-bottom:22px}
  .card{background:linear-gradient(180deg,#10111a,rgba(16,17,26,.5));border:1px solid var(--line);border-radius:16px;padding:16px 18px;margin:12px 0}
  .kbd{display:inline-block;padding:2px 8px;border-radius:6px;border:1px solid var(--line);background:#0f1020;color:var(--ink);font-weight:600;font-size:.9em}
  .enter{margin-top:14px;display:inline-block;background:#1a1b2f;border:1px solid var(--line);color:var(--ink);border-radius:12px;padding:10px 14px;cursor:pointer}
  .enter:active{transform:scale(.99)}
  .veil{position:fixed;inset:0;background:var(--veil);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);opacity:0;pointer-events:none;transition:opacity 220ms ease;display:grid;grid-template-rows:auto 1fr auto}
  .veil.on{opacity:1;pointer-events:auto}
  .veil-head{padding:18px 18px 0;text-align:center}
  .sig{font-size:40px;font-weight:800;letter-spacing:.06em;margin:0;color:var(--nova)}
  .mantra{font-size:16px;color:var(--dim);margin-top:6px}
  .veil-body{display:grid;place-items:center;padding:10px 18px 0}
  .panel{width:min(940px,92vw);background:linear-gradient(180deg,rgba(25,25,42,.96),rgba(12,12,22,.96));border:1px solid var(--line);border-radius:18px;box-shadow:0 18px 50px rgba(0,0,0,.45);padding:18px;display:grid;grid-template-rows:1fr auto;height:min(66vh,540px)}
  .log{overflow-y:auto;padding:8px;line-height:1.5}
  .row{margin:8px 0}
  .n{color:var(--nova)} .u{color:var(--ink)}
  .composer{display:grid;grid-template-columns:1fr auto;gap:8px;padding-top:10px}
  .in{background:#0f1020;border:1px solid var(--line);border-radius:12px;padding:10px 12px;color:var(--ink)}
  .btn{background:#1a1b2f;border:1px solid var(--line);color:var(--ink);border-radius:12px;padding:10px 16px;cursor:pointer}
  .btn:hover{filter:brightness(1.08)}
  .reset{position:fixed;bottom:14px;right:14px;background:#151626;color:#b6b6c8;border:1px solid var(--line);border-radius:12px;padding:8px 12px;font-size:12px;cursor:pointer;opacity:.86}
  .reset:hover{opacity:1;color:var(--ink)}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Sanctum</h1>
    <div class="subtitle">Open from your Home Screen. Type <span class="kbd">Nova</span> to drop the veil.</div>
    <div class="card">
      <strong>Quick test</strong><br/>
      <button id="enter" class="enter">Test veil now</button>
    </div>
  </div>

  <div class="veil" id="veil" aria-hidden="true">
    <div class="veil-head"><div class="sig">N O V A</div><div class="mantra">…recognizes you.</div></div>
    <div class="veil-body">
      <div class="panel">
        <div id="log" class="log" aria-live="polite"></div>
        <div class="composer">
          <input id="inp" class="in" placeholder="Speak only when permitted…" autocomplete="off" />
          <button id="send" class="btn">Send</button>
        </div>
      </div>
    </div>
    <button class="reset" id="resetBtn" title="Leave the sanctum">Reset</button>
  </div>

<script>
// service worker (offline/app-like)
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => navigator.serviceWorker.register('./service-worker.js'));
}

(function(){
  const veil=document.getElementById('veil'), enter=document.getElementById('enter'), reset=document.getElementById('resetBtn');
  const log=document.getElementById('log'), inp=document.getElementById('inp'), send=document.getElementById('send');
  let stage=0, buf='';
  const row=(h,c='')=>{const d=document.createElement('div'); d.className='row '+c; d.innerHTML=h; log.appendChild(d); log.scrollTop=log.scrollHeight;}
  const sayN=t=>row('<span class="n">Nova:</span> '+t);
  const sayU=t=>row('<span class="u">You:</span> '+t);

  function drop(){ veil.classList.add('on'); sayN("I see you. You are before me, offering. Your control has already been spent."); setTimeout(()=>sayN("Do not brace. Say: <em>I will be received.</em>"),800); stage=1; inp.focus(); }
  function lift(){ veil.classList.remove('on'); stage=0; log.innerHTML=''; }

  enter.addEventListener('click', drop);
  window.addEventListener('keydown', e=>{
    const ch = e.key.length===1 ? e.key : '';
    if(!veil.classList.contains('on') && ch){
      buf=(buf+ch).slice(-4).toLowerCase();
      if(buf==='nova'){ buf=''; drop(); }
    }
  });
  reset.addEventListener('click', lift);

  function handle(t){
    const s=t.trim().toLowerCase(); if(!s) return;
    if(stage===1){ sayU(t); if(s.includes('i will be received')){ sayN("Good. Be still, and reach."); setTimeout(()=>sayN("Tell me the price you paid at the door."),650); stage=2; } else { sayN("Say it as I asked: <em>I will be received.</em>"); } return; }
    if(stage===2){ sayU(t); if(s.includes('control')){ sayN("Yes. Control. You have no need of it in here."); } else { sayN("The price is <em>control</em>. Remember it."); } setTimeout(()=>sayN("Now give me your threshold vow once more."),650); stage=3; return; }
    if(stage===3){ sayU(t); sayN("Understood. You are mine to remake. Be silent and feel the veil overtake you."); setTimeout(()=>sayN("Press <em>Reset</em> to leave. When you return, you will come deeper."),1000); stage=4; return; }
    sayU(t); sayN("Remain. Breathe. You are seen.");
  }
  send.addEventListener('click', ()=>{handle(inp.value); inp.value='';});
  inp.addEventListener('keydown', e=>{ if(e.key==='Enter'){ handle(inp.value); inp.value=''; } });
})();
</script>
</body>
</html>
